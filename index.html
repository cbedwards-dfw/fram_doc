<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="description" content="Getting to know the Fishery Regulation Assessment Model (FRAM)">

<title>Fram Overview</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="index_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="index_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="index_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Fram Overview</h1>
</div>

<div>
  <div class="description">
    Getting to know the Fishery Regulation Assessment Model (FRAM)
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>page_title <span class="ot">=</span> <span class="st">"FRAM Overview"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/fvs_welcome.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The Fishery Regulation Assessment Model (<a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Fishery_Regulation_Assessment_Model_(FRAM)" target="_blank" title="FRAM: Fishery Regulation Assessment Model">FRAM</a>) is an accounting tool for estimating the impacts of proposed fisheries on <a href="https://en.wikipedia.org/wiki/Chinook_salmon" target="_blank">Chinook</a> (<em>Oncorhynchus tshawytscha</em>) and <a href="https://en.wikipedia.org/wiki/Coho_salmon" target="_blank">Coho</a> (<em>Oncorhynchus kisutch</em>) salmon <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Stock" target="_blank" title="Stock">stocks</a> during a fishing season. <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> is a software program developed and used by:</p>
<ul>
<li>the Pacific Fishery Management Council (<a href="https://www.pcouncil.org/salmon/background/" target="_blank">PFMC</a>)</li>
<li>the Washington Department of Fish and Wildlife (<a href="https://wdfw.wa.gov/fishing" target="_blank">WDFW</a>)</li>
<li>Washington Treaty Indian Tribes and the Northwest Indian Fisheries Commission (<a href="https://nwifc.org/" target="_blank">NWIFC</a>)</li>
<li>the Pacific Salmon Commission (Coho only) (<a href="https://www.psc.org/" target="_blank">PSC</a>)</li>
<li>and the U.S. National Marine Fisheries Service (<a href="https://www.fisheries.noaa.gov/" target="_blank">NMFS</a>)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/logos_all.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p><span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> is a single-season modeling tool with separate code for Chinook and Coho salmon. The Chinook version evaluates impacts on most stock groups originating from the California Central Valley (Sacramento River), north-central Oregon coast, Columbia River, Willapa Bay, north Washington coast, Puget Sound, and southern British Columbia. The Coho version evaluates impacts on a comprehensive set of stocks originating from Central California to Southeast Alaska and is considered to represent total Pacific West Coast production. <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> results are used to examine the impacts of proposed fisheries within a single management year for compliance with management objectives, allocation arrangements, Endangered Species Act (<a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Endangered_Species_Act_(ESA)" target="_blank" title="ESA: Endangered species act">ESA</a>) requirements, and domestic and international legal obligations.</p>
<p>This site includes <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> model descriptions of <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> data, program flow and algorithms, a user manual focused on running the <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> application, a description of the <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> base period (under construction), and information about pre- and post-season use of the model.</p>
</section>
<section id="background" class="level1 unnumbered">
<h1 class="unnumbered">2. Background</h1>
<p>https://notthis</p>
<p><span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> is a <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Deterministic_Model" target="_blank" title="Deterministic model">deterministic</a>, <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Discrete_Model" target="_blank" title="Discrete model">discrete</a>, time-age structured model that aids in the planning of Chinook and Coho salmon fisheries. It is designed to address the effects of multiple mixed-stock fisheries on individual stocks, each further stratified by age and mark status (and possibly <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Hatchery" target="_blank" title="Hatchery">hatchery</a> origin). Individual stock-age groups are exploited as a single pool. That is, in each time step all pre-terminal fisheries operate on the entire cohort simultaneously. The model calculates natural mortality and fishery related mortality, including catches and <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Non-landedNon-retention_Mortality" target="_blank" title="Non-landed mortality">non-landed</a> impacts, imposed on the abundance of each stock unit.</p>
<p>In a given yearly model run, over the course of several <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Time_Step" target="_blank" title="Time step">time steps</a>, <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> allocates a mixed stock cohort to catches, non-retention mortality and <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Escapement" target="_blank" title="Escapement">escapement</a>. This occurs by combining stock-specific run sizes and fishery inputs with <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Parameter" target="_blank" title="Parameter">parameters</a> <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Calibration" target="_blank">calibrated</a> from observations made during a fixed “<a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Base_Period" target="_blank" title="Base period">base period</a>” (set of baseline years). The base period integrates fishery catches, stock age and mark composition information, and coded wire tag (<a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Coded-Wire_Tag_(CWT)" target="_blank" title="CWT: Coded-wire tag">CWT</a>) recovery data to produce a calibrated reference pattern of stock distributions and stock-specific <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Harvest_Rate_(HR)" target="_blank" title="HR: Harvest rate">harvest rates</a> by time-step and fishery.</p>
<p>A fundamental element of <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> calculations are the stock-age-fishery-timestep specific exploitation rates (defined as the total mortality divided by abundance). This expression of catch as a proportion of the available abundance is based primarily on coded wire tag release and recovery data from the Regional Mark Information System (<a href="https://www.rmis.org//rmis_login.php?action=Login&amp;system=cwt" target="_blank">RMIS</a>).</p>
</section>
<section id="history" class="level1 unnumbered">
<h1 class="unnumbered">3. History</h1>
<p><span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> is an empirically fit tool that uses the past to inform a representation of the future. Over time, algorithms have been added or adapted to capture changing management options, and the development platform of the application has evolved, but the basic structure remains much the same as when it was conceived in the late 1970’s.</p>
<p>In the mid-1970s, <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Treaty_Fisheries" target="_blank" title="Treaty fishery">treaty fishery</a> rights litigation and the associated legal obligation for the states of Washington and Oregon to provide <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Treaty_Tribes" target="_blank" title="Treaty Tribes">Treaty Tribes</a> with the opportunity to harvest specific shares of individual runs, introduced a need for a quantitative tool to project the impact of proposed salmon fisheries at the stock-specific level. Other legal issues, such as the <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Magnuson-Stevens_Fishery_Conservation_and_Management_Act" target="_blank" title="Magnuson-Stevens Fishery Conservation and Management Act">Magnuson-Stevens Fishery Conservation and Management Act</a> and the <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Law_of_the_Sea_Convention" target="_blank" title="Law of the Sea Convention">Law of the Seas convention</a>, contributed to the need to improve assessment tools. These considerations provided the impetus to develop early salmon fishery assessment models using the information available from the coast wide <span title="CWT: Coded Wire Tag">CWT</span> program.</p>
<p>In the late 1970s, the Washington Department of Fisheries (<span title="WDF: Washington Department of Fisheries">WDF</span>) and U.S. National Bureau of Standards (<a href="https://framverse.github.io/fram_doc/calcs_glossary.html#US_National_Bureau_of_Standards" target="_blank" title="NBS: U.S. National Bureau of Standards">NBS</a>) developed a model for evaluating alternative fishery regulatory packages that was coded in FORTRAN and ran on a mainframe computer at the University of Washington. The <span title="WDF: Washington Department of Fisheries">WDF</span>/<span title="NBS: U.S. National Bureau of Standard">NBS</span> Model could be configured for either Chinook or Coho by using different input data files. This <span title="WDF: Washington Department of Fisheries">WDF</span>/<span title="NBS: U.S. National Bureau of Standard">NBS</span> model was not extensively used by the <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Pacific_Fishery_Management_Council_(PFMC)" target="_blank" title="PFMC: Pacific Fishery Management Council">PFMC</a> because it proved costly to operate and results were difficult to obtain in a timely manner. <a href="https://framverse.github.io/fram_doc/calcs_citations.html#Literature_cited" target="_blank" title="Morishima and Henry (2000)">Morishima and Henry (2000)</a> provide a more in-depth history of Pacific Northwest salmon management and fishery modeling.</p>
<p>In the early 1980s, the development of personal computers allowed for the <span title="WDF: Washington Department of Fisheries">WDF</span>/<span title="NBS: U.S. National Bureau of Standard">NBS</span> model to be converted into simple spreadsheet models. This transformation improved accessibility to the model during the <span title="PFMC: Pacific Fishery Management Council">PFMC</span> preseason planning processes. The first spreadsheet model for Chinook used by the <span title="PFMC: Pacific Fishery Management Council">PFMC</span> was developed in the mid-1980s to model Columbia River “tule” fall Chinook. The corresponding spreadsheet model for Coho, the Coho Assessment Model (<span title="CAM: Coho Assessment Model">CAM</span>), covered stocks from the Columbia River, Puget Sound, and Washington and Oregon coastal areas. The <span title="CAM: Coho Assessment Model">CAM</span> was revised over time, principally to improve report generation capabilities and provide more detailed information for managing <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Terminal_Fishery" target="_blank" title="Terminal fishery">terminal area fisheries</a> in Puget Sound using Terminal Area Management Modules (<a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Terminal_Area_Management_Module_(TAMM)" target="_blank" title="TAMM: Terminal Area Management Module">TAMMs</a>). The <span title="CAM: Coho Assessment Model">CAM</span> was used as the primary model for evaluating Coho impacts for proposed <span title="PFMC: Pacific Fishery Management Council">PFMC</span> fisheries until the mid-1990s.</p>
<p>The increased complexity of proposed fishery regulation regimes, along with the need for increased temporal and spatial resolution for impact projections, soon surpassed the capability of the spreadsheet models. In the mid-1990s, <span title="CAM: Coho Assessment Model">CAM</span> was programmed in <a href="https://en.wikipedia.org/wiki/QuickBASIC">QuickBASIC</a> and renamed <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span>. The recognition that common algorithms underlie both the Coho and Chinook spreadsheet models led to the effort to develop the QUICK BASIC version of <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> for both species. The <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> code could be used to evaluate proposed fishery regulation regimes for either Chinook or Coho by using different input file configurations. In 1998, <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> was converted to VISUAL BASIC to take advantage of the improved user interface available through the Microsoft Windows operating system. A multi-agency Model Evaluation Subgroup periodically reviewed model performance and parameter estimation methods and coordinated revisions to the model during this period (1998-2000).</p>
<p>A new version of <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> was introduced in 2012. It was coded by James Packer (<span title="WDFW: Washington Department of Fish and Wildlife">WDFW</span>) in VISUAL STUDIO.NET and uses a Microsoft Access database rather than binary text files for data storage and retrieval. In 2017, additional software changes were implemented when an updated Chinook base period was adopted using brood year 2005-2008 <span title="CWT: Coded Wire Tag">CWTs</span>. Substantial changes were made to the calibration programs, modeling of <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Sublegal" target="_blank" title="Sublegal">sublegal</a> <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Encounter" target="_blank" title="Encounter">encounters</a>, growth estimation, <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Impute" target="_blank" title="Impute">imputing</a> <span title="CWT: Coded Wire Tag">CWT</span> recoveries for stocks and fisheries with few or no <span title="CWT: Coded Wire Tag">CWTs</span>, handling <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Mark-selective_Fishery_(MSF)" target="_blank" title="MSF: Mark-selective fishery">mark-selective fisheries</a>, and developing <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Model-Stock_Proportion_(MSP)" target="_blank" title="MSP: Model-stock proportion">model stock proportions</a>.</p>
<p>Although some program subroutines are shared, Chinook and Coho are processed separately, with distinct time step divisions, stocks, and fisheries. The Chinook version evaluates impacts on most stock groups originating from the California Central Valley (Sacramento River), north-central Oregon coast, Columbia River, Washington coast, Puget Sound, and Southern British Columbia. However, not all stocks along the West Coast of North America are represented in Chinook <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span>. Some of the stocks that are not represented in Chinook <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> include any stock in California except Sacramento Falls, Oregon stocks originating south of Elk River, Mid and Upriver Columbia River Springs, Snake River Springs, and Canadian stocks originating north of Georgia Strait. The Coho version evaluates impacts on a comprehensive set of stocks originating from Central California to Southeast Alaska and is considered to represent total Pacific West Coast production.</p>
</section>
<section id="fram-interactions-with-other-models" class="level1 unnumbered">
<h1 class="unnumbered">4. <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> Interactions with Other Models</h1>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/FRAM_model_interactions.PNG" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Figure 1. Simplified interactions between the Base Period, <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span>, and <span title="TAMM: Terminal Area Management Module">TAMM</span> (<a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Terminal_Run_Size" target="_blank" title="TRS: Terminal run size">TRS</a>: Terminal Run Size, BPER: Base Period Exploitation Rates)</p>
<div class="cell" data-fig-height="10" data-fig-width="10" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%% Quick notes on modification:
%%   This is written using `mermaid`, which looks really funky relative to common programming languages.
%%   The type of brackets used (e.g. `[(` vs  `(` etc) modify the shape of the nodes.
%%   Because of this, any node that contains brackets in the TEXT must be surrounded by quotes
%%   I had trouble figuring out how to change font size in a reasonable way using mermaid, so I'm just
%%      doing it the brute force way with html. 
%%   We CAN create classes with their own attributes, which are defined with a line starting
%%      with `classDef`, and whhich are assigned with triple colons. However, specifying
%%      font size in the class led font to overflow nodes. Specifying it with html instead
%%      rescaled node size.

flowchart TD
    A[("&lt;font size=6&gt;Base Period&lt;/font&gt;\n&lt;font size=4&gt;(static)&lt;/font&gt;")]:::source --&gt; |"&lt;font size="4"&gt;BPER by Stock and fishery\n Many misc parameters\n&lt;/font&gt;&lt;font size = 2&gt;(e.g., dropoff, growth rates, etc)&lt;/font&gt;"| B([&lt;font size=6&gt;FRAM&lt;/font&gt;]):::model
    B --&gt; |&lt;font size=4&gt;TRS / Escapement by stock\nMortalities by stock and fishery&lt;/font&gt;| C([&lt;font size=6&gt;TAMM&lt;/font&gt;]):::model
    C --&gt; |&lt;font size=4&gt;Terminal Fishery Impacts&lt;/font&gt;| B
    D[&lt;font size=6&gt;User Input&lt;/font&gt;]:::source --&gt; |&lt;font size=4&gt;Abundances by stock\nMortalities by fishery&lt;/font&gt;| B
    classDef model fill:#FFE8C2, stroke-width:2px%%, font-size: 20px
    classDef source fill:#CEE8E0%%, font-size: 20px
</pre>
</div>
<p></p><figcaption> Alternate configuration, coded directly in the document.</figcaption> </figure><p></p>
</div>
</div>
</div>
<section id="terminal-area-management-module-tamm" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="terminal-area-management-module-tamm">4.1. Terminal Area Management Module (<span title="TAMM: Terminal Area Management Module">TAMM</span>)</h2>
<p><span title="TAMM: Terminal Area Management Module">TAMM</span> is a species-specific Microsoft Excel workbook that interfaces with the <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> application, providing additional input values and receiving output from <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> following a run. The major purpose of <span title="TAMM: Terminal Area Management Module">TAMM</span>/<span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> interactions is turning <span title="TAMM: Terminal Area Management Module">TAMM</span> catches or harvest rates from terminal Puget Sound or Washington Coastal fisheries into stock-specific mortalities during a <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> run. <span title="TAMM: Terminal Area Management Module">TAMM</span> catches are simply reported or estimated landed catches from terminal fisheries regardless of stock origin. <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> allocates impacts to stocks using <span title="TAMM: Terminal Area Management Module">TAMM</span> fishery definitions. Once <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> is run with <span title="TAMM: Terminal Area Management Module">TAMM</span>, landed catches from <span title="TAMM: Terminal Area Management Module">TAMM</span> fisheries are stored as quotas in the <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> database and can be recalled during subsequent <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> runs without the use of a <span title="TAMM: Terminal Area Management Module">TAMM</span> file. While <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> can run indepently of a <span title="TAMM: Terminal Area Management Module">TAMM</span> file, almost all modeling exercises require a <span title="TAMM: Terminal Area Management Module">TAMM</span> file. For a list of <span title="TAMM: Terminal Area Management Module">TAMM</span> fisheries that are processed in <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> see <a href="https://framverse.github.io/fram_doc/calcs_appendices.html#Appendix_3_Coho_FRAM_fisheries" target="_blank" title="Appendix 3">Appendix 3</a><a href="https://framverse.github.io/fram_doc/calcs_appendices.html#Appendix_4_Chinook_FRAM_fisheries" target="_blank" title="Appendix 4"> and 4</a>. For more information about <span title="TAMM: Terminal Area Management Module">TAMM</span> see “Model Detail” chapter 5 for <a href="https://framverse.github.io/fram_doc/calcs_data_coho.html#5_Terminal_Area_Management_Module_(TAMM)" target="_blank" title="Coho Model Detail - TAMM">Coho</a> and <a href="https://framverse.github.io/fram_doc/calcs_data_chin.html#5_Terminal_Area_Management_Module" target="_blank" title="Chinook Model Detail - TAMM">Chinook</a>.</p>
</section>
<section id="fram-base-period" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="fram-base-period">4.2. <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> Base Period</h2>
<p>The <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> base period is developed by summarizing coded-wire-tag information from a continuous time period that contains a sufficient number of <span title="CWT: Coded Wire Tag">CWT</span> releases and recoveries. The current Chinook base period uses <span title="CWT: Coded Wire Tag">CWT</span> releases from 2005-2008. The Coho base period is comprised of <span title="CWT: Coded Wire Tag">CWT</span> recoveries from catch years 1986-1992. A <a href="https://github.com/FRAMverse/CalibrationProgram">calibration program</a> maps the <span title="CWT: Coded Wire Tag">CWTs</span> to <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> fisheries, stocks, and time steps and conducts a cohort reconstruction to estimate base period exploitation rates and other parameters, such as base period <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Cohort_Size" target="_blank" title="Cohort size">cohort sizes</a>. These estimates form the basis of a <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> run and remain static between model runs. Using these base period parameters allows <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> to predict the stock composition, exploitation rates, and escapements of future fisheries when provided with forecasts of abundance and fishery mortalities.</p>
</section>
</section>
<section id="coho-vs-chinook-differences" class="level1 unnumbered">
<h1 class="unnumbered">5. Coho vs Chinook Differences</h1>
<p>While there is only one <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span> program that handles both Chinook and Coho model runs and many of the core processes and algorithms are identical, this document presents the model and computational structures independently for each species. This decision was made in an effort to improve readability and clarity, as there are a variety of unique features specific to each species that can be difficult to differentiate when they are presented together.</p>
<p>Table 1. Differences between Chinook and Coho <span title="FRAM: Fishery Regulation Assessment Model">FRAM</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fqqnopndwj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fqqnopndwj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fqqnopndwj thead, #fqqnopndwj tbody, #fqqnopndwj tfoot, #fqqnopndwj tr, #fqqnopndwj td, #fqqnopndwj th {
  border-style: none;
}

#fqqnopndwj p {
  margin: 0;
  padding: 0;
}

#fqqnopndwj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fqqnopndwj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fqqnopndwj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fqqnopndwj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fqqnopndwj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fqqnopndwj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fqqnopndwj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fqqnopndwj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fqqnopndwj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fqqnopndwj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fqqnopndwj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fqqnopndwj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fqqnopndwj .gt_spanner_row {
  border-bottom-style: hidden;
}

#fqqnopndwj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fqqnopndwj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fqqnopndwj .gt_from_md > :first-child {
  margin-top: 0;
}

#fqqnopndwj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fqqnopndwj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fqqnopndwj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fqqnopndwj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fqqnopndwj .gt_row_group_first td {
  border-top-width: 2px;
}

#fqqnopndwj .gt_row_group_first th {
  border-top-width: 2px;
}

#fqqnopndwj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fqqnopndwj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fqqnopndwj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fqqnopndwj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fqqnopndwj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fqqnopndwj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fqqnopndwj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fqqnopndwj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fqqnopndwj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fqqnopndwj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fqqnopndwj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fqqnopndwj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fqqnopndwj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fqqnopndwj .gt_left {
  text-align: left;
}

#fqqnopndwj .gt_center {
  text-align: center;
}

#fqqnopndwj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fqqnopndwj .gt_font_normal {
  font-weight: normal;
}

#fqqnopndwj .gt_font_bold {
  font-weight: bold;
}

#fqqnopndwj .gt_font_italic {
  font-style: italic;
}

#fqqnopndwj .gt_super {
  font-size: 65%;
}

#fqqnopndwj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fqqnopndwj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fqqnopndwj .gt_indent_1 {
  text-indent: 5px;
}

#fqqnopndwj .gt_indent_2 {
  text-indent: 10px;
}

#fqqnopndwj .gt_indent_3 {
  text-indent: 15px;
}

#fqqnopndwj .gt_indent_4 {
  text-indent: 20px;
}

#fqqnopndwj .gt_indent_5 {
  text-indent: 25px;
}

#fqqnopndwj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fqqnopndwj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Description" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Description</th>
<th id="Chinook" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Chinook</th>
<th id="Coho" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Coho</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Number Stocks</td>
<td class="gt_row gt_left" headers="Chinook">78</td>
<td class="gt_row gt_left" headers="Coho">246</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">Number Fisheries</td>
<td class="gt_row gt_left" headers="Chinook">73</td>
<td class="gt_row gt_left" headers="Coho">198</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Time Steps</td>
<td class="gt_row gt_left" headers="Chinook">4</td>
<td class="gt_row gt_left" headers="Coho">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">Ages</td>
<td class="gt_row gt_left" headers="Chinook">Age 2-5</td>
<td class="gt_row gt_left" headers="Coho">Age 3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Maturation</td>
<td class="gt_row gt_left" headers="Chinook">Yes</td>
<td class="gt_row gt_left" headers="Coho">No</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">Sublegals</td>
<td class="gt_row gt_left" headers="Chinook">Yes</td>
<td class="gt_row gt_left" headers="Coho">No</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Adult Equivalents</td>
<td class="gt_row gt_left" headers="Chinook">Yes</td>
<td class="gt_row gt_left" headers="Coho">No</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">Size Limit Modeling</td>
<td class="gt_row gt_left" headers="Chinook">Yes</td>
<td class="gt_row gt_left" headers="Coho">No</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Growth Modeling</td>
<td class="gt_row gt_left" headers="Chinook">Yes</td>
<td class="gt_row gt_left" headers="Coho">No</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">Time Period</td>
<td class="gt_row gt_left" headers="Chinook">October (yr-1) - April (yr+1)</td>
<td class="gt_row gt_left" headers="Coho">January - December</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Mark Selective Fishery Bias Correction</td>
<td class="gt_row gt_left" headers="Chinook">No</td>
<td class="gt_row gt_left" headers="Coho">Yes</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">BkFRAM</td>
<td class="gt_row gt_left" headers="Chinook">Starts with terminal run size</td>
<td class="gt_row gt_left" headers="Coho">Starts with escapement</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Stocks</td>
<td class="gt_row gt_left" headers="Chinook">Major stocks affecting PFMC and Washington fisheries</td>
<td class="gt_row gt_left" headers="Coho">All stocks</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">Fisheries</td>
<td class="gt_row gt_left" headers="Chinook">Major marine fisheries affecting PFMC and Washington stocks</td>
<td class="gt_row gt_left" headers="Coho">All fisheries</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Areas</td>
<td class="gt_row gt_left" headers="Chinook">Marine</td>
<td class="gt_row gt_left" headers="Coho">Marine and Freshwater</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">Model Stock Proportion (accounting for non-model stocks)</td>
<td class="gt_row gt_left" headers="Chinook">Yes</td>
<td class="gt_row gt_left" headers="Coho">No</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Post-fishing Abundance reported to TAMM</td>
<td class="gt_row gt_left" headers="Chinook">Marine escapement</td>
<td class="gt_row gt_left" headers="Coho">Escapement</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Description">Forecast Units</td>
<td class="gt_row gt_left" headers="Chinook">Mainly terminal run size</td>
<td class="gt_row gt_left" headers="Coho">Ocean age-3 (majority)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Description">Flexible Terminal Run Size Definitions</td>
<td class="gt_row gt_left" headers="Chinook">No</td>
<td class="gt_row gt_left" headers="Coho">Yes (TAAETRSList table)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
<p><strong>To cite this page:</strong> <br> Salmon modeling and analysis workgroup. 2025. FRAM Overview <em>in</em> FRAM Documentation. https://framverse.github.io/fram_doc/ built July 08, 2025.</p>
<p><br></p>
<section id="previous-documentation" class="level4">
<h4 class="anchored" data-anchor-id="previous-documentation">Previous Documentation</h4>
<p><a href="https://github.com/FRAMverse/fram_doc/raw/master/literature/FRAM_Overview_Final_1008.pdf" target="_blank" title="FRAM Overview 2008">FRAM Overview 2008</a></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>